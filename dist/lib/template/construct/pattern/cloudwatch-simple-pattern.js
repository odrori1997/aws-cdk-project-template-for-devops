"use strict";
/*
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: MIT-0
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this
 * software and associated documentation files (the "Software"), to deal in the Software
 * without restriction, including without limitation the rights to use, copy, modify,
 * merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.CloudWatchSimplePattern = void 0;
const cloudwatch = __importStar(require("aws-cdk-lib/aws-cloudwatch"));
const base_construct_1 = require("../base/base-construct");
class CloudWatchSimplePattern extends base_construct_1.BaseConstruct {
    constructor(scope, id, props) {
        super(scope, id, props);
        this.props = props;
        this.dashboard = new cloudwatch.Dashboard(this, props.dashboardName, {
            dashboardName: `${props.projectPrefix}-${props.dashboardName}`,
        });
    }
    addTextTitleWidges(title) {
        this.dashboard.addWidgets(new cloudwatch.TextWidget({
            markdown: title,
            width: 24,
        }));
    }
    addWidgets(...widgets) {
        this.dashboard.addWidgets(...widgets);
    }
    createWidget(name, metrics, width, label) {
        const widget = new cloudwatch.GraphWidget({
            title: name,
            left: metrics,
            width: width,
            leftYAxis: {
                label: label
            }
        });
        return widget;
    }
    createWidget2(name, metrics, width) {
        const widget = new cloudwatch.GraphWidget({
            title: name,
            left: metrics,
            width: width,
            view: cloudwatch.GraphWidgetView.TIME_SERIES,
            stacked: false,
            leftYAxis: {
                min: 0,
                max: 1,
                showUnits: false
            },
        });
        return widget;
    }
    createLeftRightWidget(name, leftMetrics, rightMetrics, width) {
        const widget = new cloudwatch.GraphWidget({
            title: name,
            left: leftMetrics,
            right: rightMetrics,
            width: width
        });
        return widget;
    }
    createDynamoDBMetric(tableName, metricName, options = {}, operation) {
        var dimensions = { TableName: tableName };
        if (operation != undefined) {
            dimensions['operation'] = operation;
        }
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/DynamoDB',
            dimensionsMap: dimensions,
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createLambdaMetric(lambdaFunctionName, metricName, options = {}) {
        /*
        Options:
         - Sum : cloudwatch.Unit.COUNT
         - Average/Minimum/Maximum : Milliseconds
        */
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/Lambda',
            dimensionsMap: {
                FunctionName: lambdaFunctionName.includes(':') ? lambdaFunctionName.split(':')[0] : lambdaFunctionName,
                Resource: lambdaFunctionName //lambdaNameAlias
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createIotMetric(ruleName, metricName, actionType, options = {}) {
        /*
        Options:
         - Sum : cloudwatch.Unit.COUNT
         - Average/Minimum/Maximum : Milliseconds
        */
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/IoT',
            dimensionsMap: {
                RuleName: ruleName,
                ActionType: actionType
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createKinesisMetric(streamName, metricName, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/Kinesis',
            dimensionsMap: {
                StreamName: streamName
            },
            unit: cloudwatch.Unit.COUNT,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createEndpointInstanceMetrics(endpointName, variantName, metricNames, options = {}) {
        const metric = metricNames.map(metricName => {
            return new cloudwatch.Metric({
                metricName,
                namespace: '/aws/sagemaker/Endpoints',
                dimensionsMap: {
                    EndpointName: endpointName,
                    VariantName: variantName,
                },
                statistic: 'Average',
                unit: cloudwatch.Unit.PERCENT,
                period: this.props.commonPeriod,
                label: options.label != undefined ? options.label : metricName,
                ...options
            });
        });
        return metric;
    }
    createEndpointInvocationMetrics(endpointName, variantName, metricNames, options = {}) {
        const metric = metricNames.map(metricName => {
            return new cloudwatch.Metric({
                metricName,
                namespace: 'AWS/SageMaker',
                dimensionsMap: {
                    EndpointName: endpointName,
                    VariantName: variantName,
                },
                statistic: options.statistic,
                unit: options.unit,
                period: this.props.commonPeriod,
                label: options.label != undefined ? options.label : metricName,
                ...options
            });
        });
        return metric;
    }
    createEsDomainMetric(domainName, metricName, clientId, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/ES',
            dimensionsMap: {
                DomainName: domainName,
                ClientId: clientId
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            color: options.color,
            ...options
        });
    }
    createEsDomainMetric2(domainName, metricName, clientId, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: '.',
            dimensionsMap: {
                DomainName: domainName,
                '.': '.'
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            color: options.color,
            ...options
        });
    }
    createApiGatewayMetric(apiName, metricName, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/ApiGateway',
            dimensionsMap: {
                ApiName: apiName,
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createSnsMetric(topicName, metricName, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/SNS',
            dimensionsMap: {
                TopicName: topicName,
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createCustomMetric(namespace, metricName, dimensions, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: namespace,
            dimensionsMap: dimensions,
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
}
exports.CloudWatchSimplePattern = CloudWatchSimplePattern;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWR3YXRjaC1zaW1wbGUtcGF0dGVybi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2xpYi90ZW1wbGF0ZS9jb25zdHJ1Y3QvcGF0dGVybi9jbG91ZHdhdGNoLXNpbXBsZS1wYXR0ZXJuLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztHQWdCRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFJSCx1RUFBeUQ7QUFHekQsMkRBQTZFO0FBTzdFLE1BQWEsdUJBQXdCLFNBQVEsOEJBQWE7SUFLdEQsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFtQztRQUN6RSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUVuQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLGFBQWEsRUFBRTtZQUNqRSxhQUFhLEVBQUUsR0FBRyxLQUFLLENBQUMsYUFBYSxJQUFJLEtBQUssQ0FBQyxhQUFhLEVBQUU7U0FDakUsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVNLGtCQUFrQixDQUFDLEtBQWE7UUFDbkMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBSSxVQUFVLENBQUMsVUFBVSxDQUFDO1lBQ2hELFFBQVEsRUFBRSxLQUFLO1lBQ2YsS0FBSyxFQUFFLEVBQUU7U0FDVixDQUFDLENBQUMsQ0FBQztJQUNWLENBQUM7SUFFTSxVQUFVLENBQUMsR0FBRyxPQUFrQjtRQUNuQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFTSxZQUFZLENBQUMsSUFBWSxFQUFFLE9BQTZCLEVBQUUsS0FBYyxFQUFFLEtBQWM7UUFDM0YsTUFBTSxNQUFNLEdBQUcsSUFB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QUFDLFNBQWlCLEVBQUUsVUFBa0IsRUFBRSxVQUFlLEVBQUUsVUFBb0MsRUFBRTtRQUNwSCxPQUFPLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQztZQUN6QixVQUFVO1lBQ1YsU0FBUyxFQUFFLFNBQVM7WUFDcEIsYUFBYSxFQUFFLFVBQVU7WUFDekIsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTO1lBQzVCLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSTtZQUNsQixNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZO1lBQy9CLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSyxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsVUFBVTtZQUM5RCxHQUFHLE9BQU87U0FDYixDQUFDLENBQUM7SUFDUCxDQUFDO0NBQ0o7QUE5UEQsMERBOFBDIiwic291cmNlc0NvbnRlbnQiOlsiXG4vKlxuICogQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlULTBcbiAqXG4gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXNcbiAqIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZVxuICogd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LFxuICogbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0b1xuICogcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLlxuICpcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IgSU1QTElFRCxcbiAqIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBXG4gKiBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUXG4gKiBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT05cbiAqIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRVxuICogU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG4gKi9cblxuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0ICogYXMgY2xvdWR3YXRjaCBmcm9tICdhd3MtY2RrLWxpYi9hd3MtY2xvdWR3YXRjaCc7XG5pbXBvcnQgeyBJV2lkZ2V0IH0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1jbG91ZHdhdGNoXCI7XG5cbmltcG9ydCB7IEJhc2VDb25zdHJ1Y3QsIENvbnN0cnVjdENvbW1vblByb3BzIH0gZnJvbSAnLi4vYmFzZS9iYXNlLWNvbnN0cnVjdCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2xvdWRXYXRjaFNpbXBsZVBhdHRlcm5Qcm9wcyBleHRlbmRzIENvbnN0cnVjdENvbW1vblByb3BzIHtcbiAgICByZWFkb25seSBkYXNoYm9hcmROYW1lOiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgY29tbW9uUGVyaW9kOiBjZGsuRHVyYXRpb247XG59XG5cbmV4cG9ydCBjbGFzcyBDbG91ZFdhdGNoU2ltcGxlUGF0dGVybiBleHRlbmRzIEJhc2VDb25zdHJ1Y3Qge1xuXG4gICAgcHJpdmF0ZSBkYXNoYm9hcmQ6IGNsb3Vkd2F0Y2guRGFzaGJvYXJkO1xuICAgIHByaXZhdGUgcHJvcHM6IENsb3VkV2F0Y2hTaW1wbGVQYXR0ZXJuUHJvcHM7XG5cbiAgICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQ2xvdWRXYXRjaFNpbXBsZVBhdHRlcm5Qcm9wcykge1xuICAgICAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcbiAgICAgICAgdGhpcy5wcm9wcyA9IHByb3BzO1xuXG4gICAgICAgIHRoaXMuZGFzaGJvYXJkID0gbmV3IGNsb3Vkd2F0Y2guRGFzaGJvYXJkKHRoaXMsIHByb3BzLmRhc2hib2FyZE5hbWUsIHtcbiAgICAgICAgICAgIGRhc2hib2FyZE5hbWU6IGAke3Byb3BzLnByb2plY3RQcmVmaXh9LSR7cHJvcHMuZGFzaGJvYXJkTmFtZX1gLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWRkVGV4dFRpdGxlV2lkZ2VzKHRpdGxlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5kYXNoYm9hcmQuYWRkV2lkZ2V0cyhuZXcgY2xvdWR3YXRjaC5UZXh0V2lkZ2V0KHtcbiAgICAgICAgICAgIG1hcmtkb3duOiB0aXRsZSxcbiAgICAgICAgICAgIHdpZHRoOiAyNCxcbiAgICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgcHVibGljIGFkZFdpZGdldHMoLi4ud2lkZ2V0czogSVdpZGdldFtdKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZGFzaGJvYXJkLmFkZFdpZGdldHMoLi4ud2lkZ2V0cyk7XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZVdpZGdldChuYW1lOiBzdHJpbmcsIG1ldHJpY3M6IGNsb3Vkd2F0Y2guSU1ldHJpY1tdLCB3aWR0aD86IG51bWJlciwgbGFiZWw/OiBzdHJpbmcpOiBjbG91ZHdhdGNoLkdyYXBoV2lkZ2V0IHtcbiAgICAgICAgY29uc3Qgd2lkZ2V0ID0gbmV3IGNsb3Vkd2F0Y2guR3JhcGhXaWRnZXQoe1xuICAgICAgICAgICAgdGl0bGU6IG5hbWUsXG4gICAgICAgICAgICBsZWZ0OiBtZXRyaWNzLFxuICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgbGVmdFlBeGlzOiB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IGxhYmVsXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gd2lkZ2V0O1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVXaWRnZXQyKG5hbWU6IHN0cmluZywgbWV0cmljczogY2xvdWR3YXRjaC5JTWV0cmljW10sIHdpZHRoPzogbnVtYmVyKTogY2xvdWR3YXRjaC5HcmFwaFdpZGdldCB7XG4gICAgICAgIGNvbnN0IHdpZGdldCA9IG5ldyBjbG91ZHdhdGNoLkdyYXBoV2lkZ2V0KHsgXG4gICAgICAgICAgICB0aXRsZTogbmFtZSxcbiAgICAgICAgICAgIGxlZnQ6IG1ldHJpY3MsXG4gICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICB2aWV3OiBjbG91ZHdhdGNoLkdyYXBoV2lkZ2V0Vmlldy5USU1FX1NFUklFUyxcbiAgICAgICAgICAgIHN0YWNrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgbGVmdFlBeGlzOiB7XG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIG1heDogMSxcbiAgICAgICAgICAgICAgICBzaG93VW5pdHM6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHdpZGdldDtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlTGVmdFJpZ2h0V2lkZ2V0KG5hbWU6IHN0cmluZywgbGVmdE1ldHJpY3M6IGNsb3Vkd2F0Y2guSU1ldHJpY1tdLCByaWdodE1ldHJpY3M6IGNsb3Vkd2F0Y2guSU1ldHJpY1tdLCB3aWR0aD86IG51bWJlcik6IGNsb3Vkd2F0Y2guR3JhcGhXaWRnZXQge1xuICAgICAgICBjb25zdCB3aWRnZXQgPSBuZXcgY2xvdWR3YXRjaC5HcmFwaFdpZGdldCh7XG4gICAgICAgICAgICB0aXRsZTogbmFtZSxcbiAgICAgICAgICAgIGxlZnQ6IGxlZnRNZXRyaWNzLFxuICAgICAgICAgICAgcmlnaHQ6IHJpZ2h0TWV0cmljcyxcbiAgICAgICAgICAgIHdpZHRoOiB3aWR0aFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHdpZGdldDtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlRHluYW1vREJNZXRyaWModGFibGVOYW1lOiBzdHJpbmcsIG1ldHJpY05hbWU6IHN0cmluZywgb3B0aW9uczogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zID0ge30sIG9wZXJhdGlvbj86IHN0cmluZyk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICAgICAgdmFyIGRpbWVuc2lvbnM6IGFueSA9IHsgVGFibGVOYW1lOiB0YWJsZU5hbWUgfTtcbiAgICAgICAgaWYgKG9wZXJhdGlvbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGRpbWVuc2lvbnNbJ29wZXJhdGlvbiddID0gb3BlcmF0aW9uXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcbiAgICAgICAgICAgIG1ldHJpY05hbWUsXG4gICAgICAgICAgICBuYW1lc3BhY2U6ICdBV1MvRHluYW1vREInLFxuICAgICAgICAgICAgZGltZW5zaW9uc01hcDogZGltZW5zaW9ucyxcbiAgICAgICAgICAgIHN0YXRpc3RpYzogb3B0aW9ucy5zdGF0aXN0aWMsXG4gICAgICAgICAgICB1bml0OiBvcHRpb25zLnVuaXQsXG4gICAgICAgICAgICBwZXJpb2Q6IHRoaXMucHJvcHMuY29tbW9uUGVyaW9kLFxuICAgICAgICAgICAgbGFiZWw6IG9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sYWJlbCA6IG1ldHJpY05hbWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVMYW1iZGFNZXRyaWMobGFtYmRhRnVuY3Rpb25OYW1lOiBzdHJpbmcsIG1ldHJpY05hbWU6IHN0cmluZywgb3B0aW9uczogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zID0ge30pOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgICAgIC8qXG4gICAgICAgIE9wdGlvbnM6XG4gICAgICAgICAtIFN1bSA6IGNsb3Vkd2F0Y2guVW5pdC5DT1VOVFxuICAgICAgICAgLSBBdmVyYWdlL01pbmltdW0vTWF4aW11bSA6IE1pbGxpc2Vjb25kc1xuICAgICAgICAqL1xuXG4gICAgICAgIHJldHVybiBuZXcgY2xvdWR3YXRjaC5NZXRyaWMoe1xuICAgICAgICAgICAgbWV0cmljTmFtZSxcbiAgICAgICAgICAgIG5hbWVzcGFjZTogJ0FXUy9MYW1iZGEnLFxuICAgICAgICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICAgICAgICAgIEZ1bmN0aW9uTmFtZTogbGFtYmRhRnVuY3Rpb25OYW1lLmluY2x1ZGVzKCc6JykgPyBsYW1iZGFGdW5jdGlvbk5hbWUuc3BsaXQoJzonKVswXSA6IGxhbWJkYUZ1bmN0aW9uTmFtZSwgLy9sYW1iZGFOYW1lQWxpYXMuc3BsaXQoJzonKVswXSxcbiAgICAgICAgICAgICAgICBSZXNvdXJjZTogbGFtYmRhRnVuY3Rpb25OYW1lICAgICAgLy9sYW1iZGFOYW1lQWxpYXNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdGF0aXN0aWM6IG9wdGlvbnMuc3RhdGlzdGljLCAvLyBTdW1cbiAgICAgICAgICAgIHVuaXQ6IG9wdGlvbnMudW5pdCwgLy9jbG91ZHdhdGNoLlVuaXQuQ09VTlRcbiAgICAgICAgICAgIHBlcmlvZDogdGhpcy5wcm9wcy5jb21tb25QZXJpb2QsXG4gICAgICAgICAgICBsYWJlbDogb3B0aW9ucy5sYWJlbCAhPSB1bmRlZmluZWQgPyBvcHRpb25zLmxhYmVsIDogbWV0cmljTmFtZSxcbiAgICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZUlvdE1ldHJpYyhydWxlTmFtZTogc3RyaW5nLCBtZXRyaWNOYW1lOiBzdHJpbmcsIGFjdGlvblR5cGU6IHN0cmluZywgb3B0aW9uczogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zID0ge30pOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgICAgIC8qXG4gICAgICAgIE9wdGlvbnM6XG4gICAgICAgICAtIFN1bSA6IGNsb3Vkd2F0Y2guVW5pdC5DT1VOVFxuICAgICAgICAgLSBBdmVyYWdlL01pbmltdW0vTWF4aW11bSA6IE1pbGxpc2Vjb25kc1xuICAgICAgICAqL1xuXG4gICAgICAgIHJldHVybiBuZXcgY2xvdWR3YXRjaC5NZXRyaWMoe1xuICAgICAgICAgICAgbWV0cmljTmFtZSxcbiAgICAgICAgICAgIG5hbWVzcGFjZTogJ0FXUy9Jb1QnLFxuICAgICAgICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICAgICAgICAgIFJ1bGVOYW1lOiBydWxlTmFtZSxcbiAgICAgICAgICAgICAgICBBY3Rpb25UeXBlOiBhY3Rpb25UeXBlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RhdGlzdGljOiBvcHRpb25zLnN0YXRpc3RpYywgLy8gU3VtXG4gICAgICAgICAgICB1bml0OiBvcHRpb25zLnVuaXQsIC8vY2xvdWR3YXRjaC5Vbml0LkNPVU5UXG4gICAgICAgICAgICBwZXJpb2Q6IHRoaXMucHJvcHMuY29tbW9uUGVyaW9kLFxuICAgICAgICAgICAgbGFiZWw6IG9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sYWJlbCA6IG1ldHJpY05hbWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVLaW5lc2lzTWV0cmljKHN0cmVhbU5hbWU6IHN0cmluZywgbWV0cmljTmFtZTogc3RyaW5nLCBvcHRpb25zOiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMgPSB7fSk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICAgICAgcmV0dXJuIG5ldyBjbG91ZHdhdGNoLk1ldHJpYyh7XG4gICAgICAgICAgICBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiAnQVdTL0tpbmVzaXMnLFxuICAgICAgICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICAgICAgICAgIFN0cmVhbU5hbWU6IHN0cmVhbU5hbWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1bml0OiBjbG91ZHdhdGNoLlVuaXQuQ09VTlQsXG4gICAgICAgICAgICBwZXJpb2Q6IHRoaXMucHJvcHMuY29tbW9uUGVyaW9kLFxuICAgICAgICAgICAgbGFiZWw6IG9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sYWJlbCA6IG1ldHJpY05hbWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVFbmRwb2ludEluc3RhbmNlTWV0cmljcyhlbmRwb2ludE5hbWU6IHN0cmluZywgdmFyaWFudE5hbWU6IHN0cmluZywgbWV0cmljTmFtZXM6IHN0cmluZ1tdLCBvcHRpb25zOiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMgPSB7fSk6IGNsb3Vkd2F0Y2guTWV0cmljW10ge1xuICAgICAgICBjb25zdCBtZXRyaWM6IGNsb3Vkd2F0Y2guTWV0cmljW10gPSBtZXRyaWNOYW1lcy5tYXAobWV0cmljTmFtZSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcbiAgICAgICAgICAgICAgICBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgICAgIG5hbWVzcGFjZTogJy9hd3Mvc2FnZW1ha2VyL0VuZHBvaW50cycsXG4gICAgICAgICAgICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICAgICAgICAgICAgICBFbmRwb2ludE5hbWU6IGVuZHBvaW50TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgVmFyaWFudE5hbWU6IHZhcmlhbnROYW1lLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3RhdGlzdGljOiAnQXZlcmFnZScsXG4gICAgICAgICAgICAgICAgdW5pdDogY2xvdWR3YXRjaC5Vbml0LlBFUkNFTlQsXG4gICAgICAgICAgICAgICAgcGVyaW9kOiB0aGlzLnByb3BzLmNvbW1vblBlcmlvZCxcbiAgICAgICAgICAgICAgICBsYWJlbDogb3B0aW9ucy5sYWJlbCAhPSB1bmRlZmluZWQgPyBvcHRpb25zLmxhYmVsIDogbWV0cmljTmFtZSxcbiAgICAgICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4gbWV0cmljO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVFbmRwb2ludEludm9jYXRpb25NZXRyaWNzKGVuZHBvaW50TmFtZTogc3RyaW5nLCB2YXJpYW50TmFtZTogc3RyaW5nLCBtZXRyaWNOYW1lczogc3RyaW5nW10sIG9wdGlvbnM6IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyA9IHt9KTogY2xvdWR3YXRjaC5NZXRyaWNbXSB7XG4gICAgICAgIGNvbnN0IG1ldHJpYzogY2xvdWR3YXRjaC5NZXRyaWNbXSA9IG1ldHJpY05hbWVzLm1hcChtZXRyaWNOYW1lID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgY2xvdWR3YXRjaC5NZXRyaWMoe1xuICAgICAgICAgICAgICAgIG1ldHJpY05hbWUsXG4gICAgICAgICAgICAgICAgbmFtZXNwYWNlOiAnQVdTL1NhZ2VNYWtlcicsXG4gICAgICAgICAgICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICAgICAgICAgICAgICBFbmRwb2ludE5hbWU6IGVuZHBvaW50TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgVmFyaWFudE5hbWU6IHZhcmlhbnROYW1lLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3RhdGlzdGljOiBvcHRpb25zLnN0YXRpc3RpYywgLy8gU3VtLCBBdmVyYWdlXG4gICAgICAgICAgICAgICAgdW5pdDogb3B0aW9ucy51bml0LCAvL2Nsb3Vkd2F0Y2guVW5pdC5DT1VOVCBNaWxsaXNlY29uZHNcbiAgICAgICAgICAgICAgICBwZXJpb2Q6IHRoaXMucHJvcHMuY29tbW9uUGVyaW9kLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBvcHRpb25zLmxhYmVsICE9IHVuZGVmaW5lZCA/IG9wdGlvbnMubGFiZWwgOiBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuXG4gICAgICAgIHJldHVybiBtZXRyaWM7XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZUVzRG9tYWluTWV0cmljKGRvbWFpbk5hbWU6IHN0cmluZywgbWV0cmljTmFtZTogc3RyaW5nLCBjbGllbnRJZDogc3RyaW5nLCBvcHRpb25zOiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMgPSB7fSk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICAgICAgcmV0dXJuIG5ldyBjbG91ZHdhdGNoLk1ldHJpYyh7XG4gICAgICAgICAgICBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiAnQVdTL0VTJyxcbiAgICAgICAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgICAgICAgICBEb21haW5OYW1lOiBkb21haW5OYW1lLFxuICAgICAgICAgICAgICAgIENsaWVudElkOiBjbGllbnRJZFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0YXRpc3RpYzogb3B0aW9ucy5zdGF0aXN0aWMsXG4gICAgICAgICAgICB1bml0OiBvcHRpb25zLnVuaXQsXG4gICAgICAgICAgICBwZXJpb2Q6IHRoaXMucHJvcHMuY29tbW9uUGVyaW9kLFxuICAgICAgICAgICAgbGFiZWw6IG9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sYWJlbCA6IG1ldHJpY05hbWUsXG4gICAgICAgICAgICBjb2xvcjogb3B0aW9ucy5jb2xvcixcbiAgICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHB1YmxpYyBjcmVhdGVFc0RvbWFpbk1ldHJpYzIoZG9tYWluTmFtZTogc3RyaW5nLCBtZXRyaWNOYW1lOiBzdHJpbmcsIGNsaWVudElkOiBzdHJpbmcsIG9wdGlvbnM6IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyA9IHt9KTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgICAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcbiAgICAgICAgICAgIG1ldHJpY05hbWUsXG4gICAgICAgICAgICBuYW1lc3BhY2U6ICcuJyxcbiAgICAgICAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgICAgICAgICBEb21haW5OYW1lOiBkb21haW5OYW1lLFxuICAgICAgICAgICAgICAgICcuJzogJy4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RhdGlzdGljOiBvcHRpb25zLnN0YXRpc3RpYyxcbiAgICAgICAgICAgIHVuaXQ6IG9wdGlvbnMudW5pdCxcbiAgICAgICAgICAgIHBlcmlvZDogdGhpcy5wcm9wcy5jb21tb25QZXJpb2QsXG4gICAgICAgICAgICBsYWJlbDogb3B0aW9ucy5sYWJlbCAhPSB1bmRlZmluZWQgPyBvcHRpb25zLmxhYmVsIDogbWV0cmljTmFtZSxcbiAgICAgICAgICAgIGNvbG9yOiBvcHRpb25zLmNvbG9yLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlQXBpR2F0ZXdheU1ldHJpYyhhcGlOYW1lOiBzdHJpbmcsIG1ldHJpY05hbWU6IHN0cmluZywgb3B0aW9uczogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zID0ge30pOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgICAgIHJldHVybiBuZXcgY2xvdWR3YXRjaC5NZXRyaWMoe1xuICAgICAgICAgICAgbWV0cmljTmFtZSxcbiAgICAgICAgICAgIG5hbWVzcGFjZTogJ0FXUy9BcGlHYXRld2F5JyxcbiAgICAgICAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgICAgICAgICBBcGlOYW1lOiBhcGlOYW1lLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0YXRpc3RpYzogb3B0aW9ucy5zdGF0aXN0aWMsXG4gICAgICAgICAgICB1bml0OiBvcHRpb25zLnVuaXQsXG4gICAgICAgICAgICBwZXJpb2Q6IHRoaXMucHJvcHMuY29tbW9uUGVyaW9kLFxuICAgICAgICAgICAgbGFiZWw6IG9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sYWJlbCA6IG1ldHJpY05hbWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVTbnNNZXRyaWModG9waWNOYW1lOiBzdHJpbmcsIG1ldHJpY05hbWU6IHN0cmluZywgb3B0aW9uczogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zID0ge30pOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgICAgIHJldHVybiBuZXcgY2xvdWR3YXRjaC5NZXRyaWMoe1xuICAgICAgICAgICAgbWV0cmljTmFtZSxcbiAgICAgICAgICAgIG5hbWVzcGFjZTogJ0FXUy9TTlMnLFxuICAgICAgICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICAgICAgICAgIFRvcGljTmFtZTogdG9waWNOYW1lLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0YXRpc3RpYzogb3B0aW9ucy5zdGF0aXN0aWMsXG4gICAgICAgICAgICB1bml0OiBvcHRpb25zLnVuaXQsXG4gICAgICAgICAgICBwZXJpb2Q6IHRoaXMucHJvcHMuY29tbW9uUGVyaW9kLFxuICAgICAgICAgICAgbGFiZWw6IG9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sYWJlbCA6IG1ldHJpY05hbWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVDdXN0b21NZXRyaWMobmFtZXNwYWNlOiBzdHJpbmcsIG1ldHJpY05hbWU6IHN0cmluZywgZGltZW5zaW9uczogYW55LCBvcHRpb25zOiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMgPSB7fSk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICAgICAgcmV0dXJuIG5ldyBjbG91ZHdhdGNoLk1ldHJpYyh7XG4gICAgICAgICAgICBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2UsXG4gICAgICAgICAgICBkaW1lbnNpb25zTWFwOiBkaW1lbnNpb25zLFxuICAgICAgICAgICAgc3RhdGlzdGljOiBvcHRpb25zLnN0YXRpc3RpYyxcbiAgICAgICAgICAgIHVuaXQ6IG9wdGlvbnMudW5pdCxcbiAgICAgICAgICAgIHBlcmlvZDogdGhpcy5wcm9wcy5jb21tb25QZXJpb2QsXG4gICAgICAgICAgICBsYWJlbDogb3B0aW9ucy5sYWJlbCAhPSB1bmRlZmluZWQgPyBvcHRpb25zLmxhYmVsIDogbWV0cmljTmFtZSxcbiAgICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl19