"use strict";
/*
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: MIT-0
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this
 * software and associated documentation files (the "Software"), to deal in the Software
 * without restriction, including without limitation the rights to use, copy, modify,
 * merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.CloudWatchSimplePattern = void 0;
const cloudwatch = __importStar(require("aws-cdk-lib/aws-cloudwatch"));
const base_construct_1 = require("../base/base-construct");
class CloudWatchSimplePattern extends base_construct_1.BaseConstruct {
    constructor(scope, id, props) {
        super(scope, id, props);
        this.props = props;
        this.dashboard = new cloudwatch.Dashboard(this, props.dashboardName, {
            dashboardName: `${props.projectPrefix}-${props.dashboardName}`,
        });
    }
    addTextTitleWidges(title) {
        this.dashboard.addWidgets(new cloudwatch.TextWidget({
            markdown: title,
            width: 24,
        }));
    }
    addWidgets(...widgets) {
        this.dashboard.addWidgets(...widgets);
    }
    createWidget(name, metrics, width, label) {
        const widget = new cloudwatch.GraphWidget({
            title: name,
            left: metrics,
            width: width,
            leftYAxis: {
                label: label
            }
        });
        return widget;
    }
    createWidget2(name, metrics, width) {
        const widget = new cloudwatch.GraphWidget({
            title: name,
            left: metrics,
            width: width,
            view: cloudwatch.GraphWidgetView.TIME_SERIES,
            stacked: false,
            leftYAxis: {
                min: 0,
                max: 1,
                showUnits: false
            },
        });
        return widget;
    }
    createLeftRightWidget(name, leftMetrics, rightMetrics, width) {
        const widget = new cloudwatch.GraphWidget({
            title: name,
            left: leftMetrics,
            right: rightMetrics,
            width: width
        });
        return widget;
    }
    createDynamoDBMetric(tableName, metricName, options = {}, operation) {
        var dimensions = { TableName: tableName };
        if (operation != undefined) {
            dimensions['operation'] = operation;
        }
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/DynamoDB',
            dimensionsMap: dimensions,
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createLambdaMetric(lambdaFunctionName, metricName, options = {}) {
        /*
        Options:
         - Sum : cloudwatch.Unit.COUNT
         - Average/Minimum/Maximum : Milliseconds
        */
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/Lambda',
            dimensionsMap: {
                FunctionName: lambdaFunctionName.includes(':') ? lambdaFunctionName.split(':')[0] : lambdaFunctionName,
                Resource: lambdaFunctionName //lambdaNameAlias
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createIotMetric(ruleName, metricName, actionType, options = {}) {
        /*
        Options:
         - Sum : cloudwatch.Unit.COUNT
         - Average/Minimum/Maximum : Milliseconds
        */
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/IoT',
            dimensionsMap: {
                RuleName: ruleName,
                ActionType: actionType
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createKinesisMetric(streamName, metricName, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/Kinesis',
            dimensionsMap: {
                StreamName: streamName
            },
            unit: cloudwatch.Unit.COUNT,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createEndpointInstanceMetrics(endpointName, variantName, metricNames, options = {}) {
        const metric = metricNames.map(metricName => {
            return new cloudwatch.Metric({
                metricName,
                namespace: '/aws/sagemaker/Endpoints',
                dimensionsMap: {
                    EndpointName: endpointName,
                    VariantName: variantName,
                },
                statistic: 'Average',
                unit: cloudwatch.Unit.PERCENT,
                period: this.props.commonPeriod,
                label: options.label != undefined ? options.label : metricName,
                ...options
            });
        });
        return metric;
    }
    createEndpointInvocationMetrics(endpointName, variantName, metricNames, options = {}) {
        const metric = metricNames.map(metricName => {
            return new cloudwatch.Metric({
                metricName,
                namespace: 'AWS/SageMaker',
                dimensionsMap: {
                    EndpointName: endpointName,
                    VariantName: variantName,
                },
                statistic: options.statistic,
                unit: options.unit,
                period: this.props.commonPeriod,
                label: options.label != undefined ? options.label : metricName,
                ...options
            });
        });
        return metric;
    }
    createEsDomainMetric(domainName, metricName, clientId, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/ES',
            dimensionsMap: {
                DomainName: domainName,
                ClientId: clientId
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            color: options.color,
            ...options
        });
    }
    createEsDomainMetric2(domainName, metricName, clientId, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: '.',
            dimensionsMap: {
                DomainName: domainName,
                '.': '.'
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            color: options.color,
            ...options
        });
    }
    createApiGatewayMetric(apiName, metricName, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/ApiGateway',
            dimensionsMap: {
                ApiName: apiName,
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createSnsMetric(topicName, metricName, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: 'AWS/SNS',
            dimensionsMap: {
                TopicName: topicName,
            },
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
    createCustomMetric(namespace, metricName, dimensions, options = {}) {
        return new cloudwatch.Metric({
            metricName,
            namespace: namespace,
            dimensionsMap: dimensions,
            statistic: options.statistic,
            unit: options.unit,
            period: this.props.commonPeriod,
            label: options.label != undefined ? options.label : metricName,
            ...options
        });
    }
}
exports.CloudWatchSimplePattern = CloudWatchSimplePattern;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWR3YXRjaC1zaW1wbGUtcGF0dGVybi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNsb3Vkd2F0Y2gtc2ltcGxlLXBhdHRlcm4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O0dBZ0JHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBSUgsdUVBQXlEO0FBR3pELDJEQUE2RTtBQU83RSxNQUFhLHVCQUF3QixTQUFRLDhCQUFhO0lBS3RELFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBbUM7UUFDekUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFFbkIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLFVBQVUsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxhQUFhLEVBQUU7WUFDakUsYUFBYSxFQUFFLEdBQUcsS0FBSyxDQUFDLGFBQWEsSUFBSSxLQUFLLENBQUMsYUFBYSxFQUFFO1NBQ2pFLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFTSxrQkFBa0IsQ0FBQyxLQUFhO1FBQ25DLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLElBQUksVUFBVSxDQUFDLFVBQVUsQ0FBQztZQUNoRCxRQUFRLEVBQUUsS0FBSztZQUNmLEtBQUssRUFBRSxFQUFFO1NBQ1YsQ0FBQyxDQUFDLENBQUM7SUFDVixDQUFDO0lBRU0sVUFBVSxDQUFDLEdBQUcsT0FBa0I7UUFDbkMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsR0FBRyxPQUFPLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRU0sWUFBWSxDQUFDLElBQVksRUFBRSxPQUE2QixFQUFFLEtBQWMsRUFBRSxLQUFjO1FBQzNGLE1BQU0sTUFBTSxHQUFHLElBQUksVUFBVSxDQUFDLFdBQVcsQ0FBQztZQUN0QyxLQUFLLEVBQUUsSUFBSTtZQUNYLElB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cEgsT0FBTyxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUM7WUFDekIsVUFBVTtZQUNWLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLGFBQWEsRUFBRSxVQUFVO1lBQ3pCLFNBQVMsRUFBRSxPQUFPLENBQUMsU0FBUztZQUM1QixJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUk7WUFDbEIsTUFBTSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWTtZQUMvQixLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUssSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVU7WUFDOUQsR0FBRyxPQUFPO1NBQ2IsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztDQUNKO0FBOVBELDBEQThQQyIsInNvdXJjZXNDb250ZW50IjpbIlxuLypcbiAqIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVC0wXG4gKlxuICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weSBvZiB0aGlzXG4gKiBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmVcbiAqIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSxcbiAqIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG9cbiAqIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzby5cbiAqXG4gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsXG4gKiBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQVxuICogUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVFxuICogSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OXG4gKiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEVcbiAqIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuICovXG5cbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCAqIGFzIGNsb3Vkd2F0Y2ggZnJvbSAnYXdzLWNkay1saWIvYXdzLWNsb3Vkd2F0Y2gnO1xuaW1wb3J0IHsgSVdpZGdldCB9IGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtY2xvdWR3YXRjaFwiO1xuXG5pbXBvcnQgeyBCYXNlQ29uc3RydWN0LCBDb25zdHJ1Y3RDb21tb25Qcm9wcyB9IGZyb20gJy4uL2Jhc2UvYmFzZS1jb25zdHJ1Y3QnO1xuXG5leHBvcnQgaW50ZXJmYWNlIENsb3VkV2F0Y2hTaW1wbGVQYXR0ZXJuUHJvcHMgZXh0ZW5kcyBDb25zdHJ1Y3RDb21tb25Qcm9wcyB7XG4gICAgcmVhZG9ubHkgZGFzaGJvYXJkTmFtZTogc3RyaW5nO1xuICAgIHJlYWRvbmx5IGNvbW1vblBlcmlvZDogY2RrLkR1cmF0aW9uO1xufVxuXG5leHBvcnQgY2xhc3MgQ2xvdWRXYXRjaFNpbXBsZVBhdHRlcm4gZXh0ZW5kcyBCYXNlQ29uc3RydWN0IHtcblxuICAgIHByaXZhdGUgZGFzaGJvYXJkOiBjbG91ZHdhdGNoLkRhc2hib2FyZDtcbiAgICBwcml2YXRlIHByb3BzOiBDbG91ZFdhdGNoU2ltcGxlUGF0dGVyblByb3BzO1xuXG4gICAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IENsb3VkV2F0Y2hTaW1wbGVQYXR0ZXJuUHJvcHMpIHtcbiAgICAgICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG4gICAgICAgIHRoaXMucHJvcHMgPSBwcm9wcztcblxuICAgICAgICB0aGlzLmRhc2hib2FyZCA9IG5ldyBjbG91ZHdhdGNoLkRhc2hib2FyZCh0aGlzLCBwcm9wcy5kYXNoYm9hcmROYW1lLCB7XG4gICAgICAgICAgICBkYXNoYm9hcmROYW1lOiBgJHtwcm9wcy5wcm9qZWN0UHJlZml4fS0ke3Byb3BzLmRhc2hib2FyZE5hbWV9YCxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGFkZFRleHRUaXRsZVdpZGdlcyh0aXRsZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuZGFzaGJvYXJkLmFkZFdpZGdldHMobmV3IGNsb3Vkd2F0Y2guVGV4dFdpZGdldCh7XG4gICAgICAgICAgICBtYXJrZG93bjogdGl0bGUsXG4gICAgICAgICAgICB3aWR0aDogMjQsXG4gICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhZGRXaWRnZXRzKC4uLndpZGdldHM6IElXaWRnZXRbXSk6IHZvaWQge1xuICAgICAgICB0aGlzLmRhc2hib2FyZC5hZGRXaWRnZXRzKC4uLndpZGdldHMpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVXaWRnZXQobmFtZTogc3RyaW5nLCBtZXRyaWNzOiBjbG91ZHdhdGNoLklNZXRyaWNbXSwgd2lkdGg/OiBudW1iZXIsIGxhYmVsPzogc3RyaW5nKTogY2xvdWR3YXRjaC5HcmFwaFdpZGdldCB7XG4gICAgICAgIGNvbnN0IHdpZGdldCA9IG5ldyBjbG91ZHdhdGNoLkdyYXBoV2lkZ2V0KHtcbiAgICAgICAgICAgIHRpdGxlOiBuYW1lLFxuICAgICAgICAgICAgbGVmdDogbWV0cmljcyxcbiAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgIGxlZnRZQXhpczoge1xuICAgICAgICAgICAgICAgIGxhYmVsOiBsYWJlbFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHdpZGdldDtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlV2lkZ2V0MihuYW1lOiBzdHJpbmcsIG1ldHJpY3M6IGNsb3Vkd2F0Y2guSU1ldHJpY1tdLCB3aWR0aD86IG51bWJlcik6IGNsb3Vkd2F0Y2guR3JhcGhXaWRnZXQge1xuICAgICAgICBjb25zdCB3aWRnZXQgPSBuZXcgY2xvdWR3YXRjaC5HcmFwaFdpZGdldCh7IFxuICAgICAgICAgICAgdGl0bGU6IG5hbWUsXG4gICAgICAgICAgICBsZWZ0OiBtZXRyaWNzLFxuICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgdmlldzogY2xvdWR3YXRjaC5HcmFwaFdpZGdldFZpZXcuVElNRV9TRVJJRVMsXG4gICAgICAgICAgICBzdGFja2VkOiBmYWxzZSxcbiAgICAgICAgICAgIGxlZnRZQXhpczoge1xuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICBtYXg6IDEsXG4gICAgICAgICAgICAgICAgc2hvd1VuaXRzOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB3aWRnZXQ7XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZUxlZnRSaWdodFdpZGdldChuYW1lOiBzdHJpbmcsIGxlZnRNZXRyaWNzOiBjbG91ZHdhdGNoLklNZXRyaWNbXSwgcmlnaHRNZXRyaWNzOiBjbG91ZHdhdGNoLklNZXRyaWNbXSwgd2lkdGg/OiBudW1iZXIpOiBjbG91ZHdhdGNoLkdyYXBoV2lkZ2V0IHtcbiAgICAgICAgY29uc3Qgd2lkZ2V0ID0gbmV3IGNsb3Vkd2F0Y2guR3JhcGhXaWRnZXQoe1xuICAgICAgICAgICAgdGl0bGU6IG5hbWUsXG4gICAgICAgICAgICBsZWZ0OiBsZWZ0TWV0cmljcyxcbiAgICAgICAgICAgIHJpZ2h0OiByaWdodE1ldHJpY3MsXG4gICAgICAgICAgICB3aWR0aDogd2lkdGhcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB3aWRnZXQ7XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZUR5bmFtb0RCTWV0cmljKHRhYmxlTmFtZTogc3RyaW5nLCBtZXRyaWNOYW1lOiBzdHJpbmcsIG9wdGlvbnM6IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyA9IHt9LCBvcGVyYXRpb24/OiBzdHJpbmcpOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgICAgIHZhciBkaW1lbnNpb25zOiBhbnkgPSB7IFRhYmxlTmFtZTogdGFibGVOYW1lIH07XG4gICAgICAgIGlmIChvcGVyYXRpb24gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBkaW1lbnNpb25zWydvcGVyYXRpb24nXSA9IG9wZXJhdGlvblxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBjbG91ZHdhdGNoLk1ldHJpYyh7XG4gICAgICAgICAgICBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiAnQVdTL0R5bmFtb0RCJyxcbiAgICAgICAgICAgIGRpbWVuc2lvbnNNYXA6IGRpbWVuc2lvbnMsXG4gICAgICAgICAgICBzdGF0aXN0aWM6IG9wdGlvbnMuc3RhdGlzdGljLFxuICAgICAgICAgICAgdW5pdDogb3B0aW9ucy51bml0LFxuICAgICAgICAgICAgcGVyaW9kOiB0aGlzLnByb3BzLmNvbW1vblBlcmlvZCxcbiAgICAgICAgICAgIGxhYmVsOiBvcHRpb25zLmxhYmVsICE9IHVuZGVmaW5lZCA/IG9wdGlvbnMubGFiZWwgOiBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlTGFtYmRhTWV0cmljKGxhbWJkYUZ1bmN0aW9uTmFtZTogc3RyaW5nLCBtZXRyaWNOYW1lOiBzdHJpbmcsIG9wdGlvbnM6IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyA9IHt9KTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgICAgICAvKlxuICAgICAgICBPcHRpb25zOlxuICAgICAgICAgLSBTdW0gOiBjbG91ZHdhdGNoLlVuaXQuQ09VTlRcbiAgICAgICAgIC0gQXZlcmFnZS9NaW5pbXVtL01heGltdW0gOiBNaWxsaXNlY29uZHNcbiAgICAgICAgKi9cblxuICAgICAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcbiAgICAgICAgICAgIG1ldHJpY05hbWUsXG4gICAgICAgICAgICBuYW1lc3BhY2U6ICdBV1MvTGFtYmRhJyxcbiAgICAgICAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgICAgICAgICBGdW5jdGlvbk5hbWU6IGxhbWJkYUZ1bmN0aW9uTmFtZS5pbmNsdWRlcygnOicpID8gbGFtYmRhRnVuY3Rpb25OYW1lLnNwbGl0KCc6JylbMF0gOiBsYW1iZGFGdW5jdGlvbk5hbWUsIC8vbGFtYmRhTmFtZUFsaWFzLnNwbGl0KCc6JylbMF0sXG4gICAgICAgICAgICAgICAgUmVzb3VyY2U6IGxhbWJkYUZ1bmN0aW9uTmFtZSAgICAgIC8vbGFtYmRhTmFtZUFsaWFzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RhdGlzdGljOiBvcHRpb25zLnN0YXRpc3RpYywgLy8gU3VtXG4gICAgICAgICAgICB1bml0OiBvcHRpb25zLnVuaXQsIC8vY2xvdWR3YXRjaC5Vbml0LkNPVU5UXG4gICAgICAgICAgICBwZXJpb2Q6IHRoaXMucHJvcHMuY29tbW9uUGVyaW9kLFxuICAgICAgICAgICAgbGFiZWw6IG9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sYWJlbCA6IG1ldHJpY05hbWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVJb3RNZXRyaWMocnVsZU5hbWU6IHN0cmluZywgbWV0cmljTmFtZTogc3RyaW5nLCBhY3Rpb25UeXBlOiBzdHJpbmcsIG9wdGlvbnM6IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyA9IHt9KTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgICAgICAvKlxuICAgICAgICBPcHRpb25zOlxuICAgICAgICAgLSBTdW0gOiBjbG91ZHdhdGNoLlVuaXQuQ09VTlRcbiAgICAgICAgIC0gQXZlcmFnZS9NaW5pbXVtL01heGltdW0gOiBNaWxsaXNlY29uZHNcbiAgICAgICAgKi9cblxuICAgICAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcbiAgICAgICAgICAgIG1ldHJpY05hbWUsXG4gICAgICAgICAgICBuYW1lc3BhY2U6ICdBV1MvSW9UJyxcbiAgICAgICAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgICAgICAgICBSdWxlTmFtZTogcnVsZU5hbWUsXG4gICAgICAgICAgICAgICAgQWN0aW9uVHlwZTogYWN0aW9uVHlwZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0YXRpc3RpYzogb3B0aW9ucy5zdGF0aXN0aWMsIC8vIFN1bVxuICAgICAgICAgICAgdW5pdDogb3B0aW9ucy51bml0LCAvL2Nsb3Vkd2F0Y2guVW5pdC5DT1VOVFxuICAgICAgICAgICAgcGVyaW9kOiB0aGlzLnByb3BzLmNvbW1vblBlcmlvZCxcbiAgICAgICAgICAgIGxhYmVsOiBvcHRpb25zLmxhYmVsICE9IHVuZGVmaW5lZCA/IG9wdGlvbnMubGFiZWwgOiBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlS2luZXNpc01ldHJpYyhzdHJlYW1OYW1lOiBzdHJpbmcsIG1ldHJpY05hbWU6IHN0cmluZywgb3B0aW9uczogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zID0ge30pOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgICAgIHJldHVybiBuZXcgY2xvdWR3YXRjaC5NZXRyaWMoe1xuICAgICAgICAgICAgbWV0cmljTmFtZSxcbiAgICAgICAgICAgIG5hbWVzcGFjZTogJ0FXUy9LaW5lc2lzJyxcbiAgICAgICAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgICAgICAgICBTdHJlYW1OYW1lOiBzdHJlYW1OYW1lXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdW5pdDogY2xvdWR3YXRjaC5Vbml0LkNPVU5ULFxuICAgICAgICAgICAgcGVyaW9kOiB0aGlzLnByb3BzLmNvbW1vblBlcmlvZCxcbiAgICAgICAgICAgIGxhYmVsOiBvcHRpb25zLmxhYmVsICE9IHVuZGVmaW5lZCA/IG9wdGlvbnMubGFiZWwgOiBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlRW5kcG9pbnRJbnN0YW5jZU1ldHJpY3MoZW5kcG9pbnROYW1lOiBzdHJpbmcsIHZhcmlhbnROYW1lOiBzdHJpbmcsIG1ldHJpY05hbWVzOiBzdHJpbmdbXSwgb3B0aW9uczogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zID0ge30pOiBjbG91ZHdhdGNoLk1ldHJpY1tdIHtcbiAgICAgICAgY29uc3QgbWV0cmljOiBjbG91ZHdhdGNoLk1ldHJpY1tdID0gbWV0cmljTmFtZXMubWFwKG1ldHJpY05hbWUgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBjbG91ZHdhdGNoLk1ldHJpYyh7XG4gICAgICAgICAgICAgICAgbWV0cmljTmFtZSxcbiAgICAgICAgICAgICAgICBuYW1lc3BhY2U6ICcvYXdzL3NhZ2VtYWtlci9FbmRwb2ludHMnLFxuICAgICAgICAgICAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgICAgICAgICAgICAgRW5kcG9pbnROYW1lOiBlbmRwb2ludE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIFZhcmlhbnROYW1lOiB2YXJpYW50TmFtZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHN0YXRpc3RpYzogJ0F2ZXJhZ2UnLFxuICAgICAgICAgICAgICAgIHVuaXQ6IGNsb3Vkd2F0Y2guVW5pdC5QRVJDRU5ULFxuICAgICAgICAgICAgICAgIHBlcmlvZDogdGhpcy5wcm9wcy5jb21tb25QZXJpb2QsXG4gICAgICAgICAgICAgICAgbGFiZWw6IG9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sYWJlbCA6IG1ldHJpY05hbWUsXG4gICAgICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIG1ldHJpYztcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlRW5kcG9pbnRJbnZvY2F0aW9uTWV0cmljcyhlbmRwb2ludE5hbWU6IHN0cmluZywgdmFyaWFudE5hbWU6IHN0cmluZywgbWV0cmljTmFtZXM6IHN0cmluZ1tdLCBvcHRpb25zOiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMgPSB7fSk6IGNsb3Vkd2F0Y2guTWV0cmljW10ge1xuICAgICAgICBjb25zdCBtZXRyaWM6IGNsb3Vkd2F0Y2guTWV0cmljW10gPSBtZXRyaWNOYW1lcy5tYXAobWV0cmljTmFtZSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcbiAgICAgICAgICAgICAgICBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgICAgIG5hbWVzcGFjZTogJ0FXUy9TYWdlTWFrZXInLFxuICAgICAgICAgICAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgICAgICAgICAgICAgRW5kcG9pbnROYW1lOiBlbmRwb2ludE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIFZhcmlhbnROYW1lOiB2YXJpYW50TmFtZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHN0YXRpc3RpYzogb3B0aW9ucy5zdGF0aXN0aWMsIC8vIFN1bSwgQXZlcmFnZVxuICAgICAgICAgICAgICAgIHVuaXQ6IG9wdGlvbnMudW5pdCwgLy9jbG91ZHdhdGNoLlVuaXQuQ09VTlQgTWlsbGlzZWNvbmRzXG4gICAgICAgICAgICAgICAgcGVyaW9kOiB0aGlzLnByb3BzLmNvbW1vblBlcmlvZCxcbiAgICAgICAgICAgICAgICBsYWJlbDogb3B0aW9ucy5sYWJlbCAhPSB1bmRlZmluZWQgPyBvcHRpb25zLmxhYmVsIDogbWV0cmljTmFtZSxcbiAgICAgICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4gbWV0cmljO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVFc0RvbWFpbk1ldHJpYyhkb21haW5OYW1lOiBzdHJpbmcsIG1ldHJpY05hbWU6IHN0cmluZywgY2xpZW50SWQ6IHN0cmluZywgb3B0aW9uczogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zID0ge30pOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgICAgIHJldHVybiBuZXcgY2xvdWR3YXRjaC5NZXRyaWMoe1xuICAgICAgICAgICAgbWV0cmljTmFtZSxcbiAgICAgICAgICAgIG5hbWVzcGFjZTogJ0FXUy9FUycsXG4gICAgICAgICAgICBkaW1lbnNpb25zTWFwOiB7XG4gICAgICAgICAgICAgICAgRG9tYWluTmFtZTogZG9tYWluTmFtZSxcbiAgICAgICAgICAgICAgICBDbGllbnRJZDogY2xpZW50SWRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdGF0aXN0aWM6IG9wdGlvbnMuc3RhdGlzdGljLFxuICAgICAgICAgICAgdW5pdDogb3B0aW9ucy51bml0LFxuICAgICAgICAgICAgcGVyaW9kOiB0aGlzLnByb3BzLmNvbW1vblBlcmlvZCxcbiAgICAgICAgICAgIGxhYmVsOiBvcHRpb25zLmxhYmVsICE9IHVuZGVmaW5lZCA/IG9wdGlvbnMubGFiZWwgOiBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgY29sb3I6IG9wdGlvbnMuY29sb3IsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwdWJsaWMgY3JlYXRlRXNEb21haW5NZXRyaWMyKGRvbWFpbk5hbWU6IHN0cmluZywgbWV0cmljTmFtZTogc3RyaW5nLCBjbGllbnRJZDogc3RyaW5nLCBvcHRpb25zOiBjbG91ZHdhdGNoLk1ldHJpY09wdGlvbnMgPSB7fSk6IGNsb3Vkd2F0Y2guTWV0cmljIHtcbiAgICAgICAgcmV0dXJuIG5ldyBjbG91ZHdhdGNoLk1ldHJpYyh7XG4gICAgICAgICAgICBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiAnLicsXG4gICAgICAgICAgICBkaW1lbnNpb25zTWFwOiB7XG4gICAgICAgICAgICAgICAgRG9tYWluTmFtZTogZG9tYWluTmFtZSxcbiAgICAgICAgICAgICAgICAnLic6ICcuJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0YXRpc3RpYzogb3B0aW9ucy5zdGF0aXN0aWMsXG4gICAgICAgICAgICB1bml0OiBvcHRpb25zLnVuaXQsXG4gICAgICAgICAgICBwZXJpb2Q6IHRoaXMucHJvcHMuY29tbW9uUGVyaW9kLFxuICAgICAgICAgICAgbGFiZWw6IG9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sYWJlbCA6IG1ldHJpY05hbWUsXG4gICAgICAgICAgICBjb2xvcjogb3B0aW9ucy5jb2xvcixcbiAgICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZUFwaUdhdGV3YXlNZXRyaWMoYXBpTmFtZTogc3RyaW5nLCBtZXRyaWNOYW1lOiBzdHJpbmcsIG9wdGlvbnM6IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyA9IHt9KTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgICAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcbiAgICAgICAgICAgIG1ldHJpY05hbWUsXG4gICAgICAgICAgICBuYW1lc3BhY2U6ICdBV1MvQXBpR2F0ZXdheScsXG4gICAgICAgICAgICBkaW1lbnNpb25zTWFwOiB7XG4gICAgICAgICAgICAgICAgQXBpTmFtZTogYXBpTmFtZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdGF0aXN0aWM6IG9wdGlvbnMuc3RhdGlzdGljLFxuICAgICAgICAgICAgdW5pdDogb3B0aW9ucy51bml0LFxuICAgICAgICAgICAgcGVyaW9kOiB0aGlzLnByb3BzLmNvbW1vblBlcmlvZCxcbiAgICAgICAgICAgIGxhYmVsOiBvcHRpb25zLmxhYmVsICE9IHVuZGVmaW5lZCA/IG9wdGlvbnMubGFiZWwgOiBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlU25zTWV0cmljKHRvcGljTmFtZTogc3RyaW5nLCBtZXRyaWNOYW1lOiBzdHJpbmcsIG9wdGlvbnM6IGNsb3Vkd2F0Y2guTWV0cmljT3B0aW9ucyA9IHt9KTogY2xvdWR3YXRjaC5NZXRyaWMge1xuICAgICAgICByZXR1cm4gbmV3IGNsb3Vkd2F0Y2guTWV0cmljKHtcbiAgICAgICAgICAgIG1ldHJpY05hbWUsXG4gICAgICAgICAgICBuYW1lc3BhY2U6ICdBV1MvU05TJyxcbiAgICAgICAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgICAgICAgICBUb3BpY05hbWU6IHRvcGljTmFtZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdGF0aXN0aWM6IG9wdGlvbnMuc3RhdGlzdGljLFxuICAgICAgICAgICAgdW5pdDogb3B0aW9ucy51bml0LFxuICAgICAgICAgICAgcGVyaW9kOiB0aGlzLnByb3BzLmNvbW1vblBlcmlvZCxcbiAgICAgICAgICAgIGxhYmVsOiBvcHRpb25zLmxhYmVsICE9IHVuZGVmaW5lZCA/IG9wdGlvbnMubGFiZWwgOiBtZXRyaWNOYW1lLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlQ3VzdG9tTWV0cmljKG5hbWVzcGFjZTogc3RyaW5nLCBtZXRyaWNOYW1lOiBzdHJpbmcsIGRpbWVuc2lvbnM6IGFueSwgb3B0aW9uczogY2xvdWR3YXRjaC5NZXRyaWNPcHRpb25zID0ge30pOiBjbG91ZHdhdGNoLk1ldHJpYyB7XG4gICAgICAgIHJldHVybiBuZXcgY2xvdWR3YXRjaC5NZXRyaWMoe1xuICAgICAgICAgICAgbWV0cmljTmFtZSxcbiAgICAgICAgICAgIG5hbWVzcGFjZTogbmFtZXNwYWNlLFxuICAgICAgICAgICAgZGltZW5zaW9uc01hcDogZGltZW5zaW9ucyxcbiAgICAgICAgICAgIHN0YXRpc3RpYzogb3B0aW9ucy5zdGF0aXN0aWMsXG4gICAgICAgICAgICB1bml0OiBvcHRpb25zLnVuaXQsXG4gICAgICAgICAgICBwZXJpb2Q6IHRoaXMucHJvcHMuY29tbW9uUGVyaW9kLFxuICAgICAgICAgICAgbGFiZWw6IG9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gb3B0aW9ucy5sYWJlbCA6IG1ldHJpY05hbWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiJdfQ==